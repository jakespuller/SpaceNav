using UnityEngine;
using System.Collections;
using System.IO;

public class ScriptMenu : MonoBehaviour {
	
	private int maxComplete;
	public GameObject gameData;
		
	// Use this for initialization
	void Start() {
		//See what the highest level is that we've already completed.  
		//We must have game data, ISA survey, and NASA TLX survey
		maxComplete = 0;
		for (int i = 1; i <= 16; i++) {
			if(File.Exists("Level_" + i + "_Data.txt") && File.Exists("ISA_feedback_" + i + ".txt") && File.Exists("NASATLX_feedback_" + i + ".txt")) {
				maxComplete = i;
			}
		}
		
		//Create a new game data object in order to capture data across Unity levels
		GameObject data = GameObject.FindGameObjectWithTag("GameData");
		if (data == null) {
			data = (GameObject) Instantiate(gameData, Vector3.zero, Quaternion.identity);
			gameData gd = (gameData) data.GetComponent("gameData");
			gd.gameLevel = maxComplete + 1;
			gd.loadExperimentSettings();
		}
	}
		
	// Update is called once per frame
	void Update () {
	}
	
	void OnGUI() {
		//Style for save button, set up so that it scales with screen size	
		GUIStyle inputButton = new GUIStyle(GUI.skin.GetStyle("Button"));
		inputButton.fontSize = Screen.width/20;
		inputButton.alignment = TextAnchor.MiddleCenter;
		
		//Create length units that are dynamic depending on screen size
		int heightUnit = Screen.height / 16;
		int widthUnit = Screen.width / 16;
		
		//Title of the page
		GUI.Box(new Rect(3*widthUnit, 1*heightUnit, 10*widthUnit, 14*heightUnit), "Main Menu");
		GUI.skin.box.fontSize = Screen.width/30;
		
		//Button to quit the game
		if(GUI.Button(new Rect(4*widthUnit, 4*heightUnit, 8*widthUnit, 4*heightUnit), "Quit Game", inputButton)) {
			Application.Quit();
		}
		
		//Button to load the next level
		GameObject data = GameObject.FindGameObjectWithTag("GameData");
		if (data != null) {
			gameData gd = (gameData) data.GetComponent("gameData");
			if(gd.setups.Count >= gd.gameLevel) {
				if(GUI.Button(new Rect(4*widthUnit, 10*heightUnit, 8*widthUnit, 4*heightUnit), "Continue Game\nLevel " + gd.gameLevel, inputButton)) {
					Application.LoadLevel(1);
				}
			} else {
				if(GUI.Button(new Rect(4*widthUnit, 10*heightUnit, 8*widthUnit, 4*heightUnit), "All Levels Complete", inputButton)) {
					Application.Quit();
				}
			}
		} else {
			Debug.LogError("No game data object exists");
			Application.Quit();	
		}
		
	}
}
